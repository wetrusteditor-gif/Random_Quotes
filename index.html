<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Get A Quote</title>
<style>
  :root{ --bg1:#667eea; --bg2:#764ba2; }
  *{margin:0;padding:0;box-sizing:border-box}
  body{
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif;
    background:linear-gradient(135deg,var(--bg1) 0%,var(--bg2) 100%);
    min-height:100vh; display:flex; align-items:center; justify-content:center; padding:16px;
  }
  .card{
    width:min(980px,100%); background:#fff; border-radius:20px; padding:28px;
    box-shadow:0 18px 60px rgba(0,0,0,.25);
  }
  h1{font-size:clamp(1.6rem,2.5vw,2.4rem); text-align:center; color:#333; font-weight:800; letter-spacing:.2px}
  .meta{margin-top:6px; text-align:center; color:#666; font-weight:500}
  .status{margin-top:8px; text-align:center; color:#888; font-size:.88rem; height:18px; display:none;}
  .viewer{
    position:relative; margin-top:18px; border-radius:16px; overflow:hidden;
    background:#f5f5f7; box-shadow:0 10px 28px rgba(0,0,0,.08);
    height:clamp(260px, 70vh, 78vh);
    display:flex; align-items:center; justify-content:center;
  }
  img#quoteImage{
    max-width:100%; max-height:100%; width:auto; height:auto; object-fit:contain;
    display:none; border-radius:14px; transition:opacity .2s ease;
  }
  img#quoteImage.show{ display:block; opacity:1 }
  .placeholder{ color:#9aa; text-align:center; padding:22px; }
  .controls{ display:flex; justify-content:center; gap:12px; margin-top:20px; flex-wrap:wrap }
  button{
    appearance:none; border:0; cursor:pointer; user-select:none;
    padding:12px 26px; border-radius:999px; font-weight:700; font-size:1rem;
    background:linear-gradient(135deg,var(--bg1),var(--bg2)); color:#fff;
    box-shadow:0 10px 24px rgba(102,126,234,.35);
    transition:transform .15s ease, box-shadow .15s ease, opacity .2s ease;
  }
  button:disabled{ opacity:.55; cursor:not-allowed; box-shadow:none }
  button:hover:not(:disabled){ transform:translateY(-1.5px); }
  .loading{
    position:absolute; inset:0; background:rgba(0,0,0,.45);
    display:flex; align-items:center; justify-content:center; z-index:5;
    flex-direction:column; gap:12px;
  }
  .spinner{
    width:52px; height:52px; border-radius:50%;
    border:5px solid rgba(255,255,255,.35);
    border-top-color:#fff; animation:spin 1s linear infinite;
  }
  .loading-text{color:#fff; font-weight:600; font-size:.95rem}
  @keyframes spin{ to{ transform:rotate(360deg) } }
  .footer{ margin-top:16px; padding-top:14px; border-top:1px solid #eee; color:#666; text-align:center; font-size:.92rem }
  @media (max-width:600px){ .card{ padding:18px } }
</style>
</head>
<body>
  <main class="card">
    <h1>‚ú® Get A Quote</h1>
    <p class="meta">Total Quotes: <strong id="totalCount">0</strong></p>
    <p class="status" id="statusText"></p>

    <section class="viewer" id="viewer">
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <div class="loading-text" id="loadingText">0% complete‚Ä¶</div>
      </div>
      <div class="placeholder" id="placeholder">Click ‚ÄúGet A Quote‚Äù to see an inspiring quote! üéØ</div>
      <img id="quoteImage" alt="Quote" decoding="async" referrerpolicy="no-referrer">
    </section>

    <div class="controls">
      <button id="randomBtn" disabled>Get A Quote</button>
    </div>

    <p class="footer">¬© Wisdom And Enlightenment Trust</p>
  </main>

<script>
  const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzYKfmVEMzFD5LDm0izPYcoI5mXyzKejVX6OCpuSOkPHTaPaL7vMl4E9yYhKU3Qp4j3PQ/exec";
  const PAGE_SIZE = 1500;

  const totalCountEl = document.getElementById("totalCount");
  const statusText = document.getElementById("statusText");
  const placeholder = document.getElementById("placeholder");
  const imgEl = document.getElementById("quoteImage");
  const randomBtn = document.getElementById("randomBtn");
  const loading = document.getElementById("loading");
  const loadingText = document.getElementById("loadingText");

  let IMAGES = [];
  let totalImagesCount = 0;

  function updateProgressText(loaded, total){
    let percent = total > 0 ? Math.floor((loaded/total)*100) : 0;
    loadingText.textContent = `${percent}% complete‚Ä¶`;
    statusText.style.display = "block";
    statusText.textContent = `${percent}% complete‚Ä¶`;
  }

  async function loadAllQuotes(){
    let page = 1, hasMore = true;
    IMAGES = [];

    while(hasMore){
      const res = await fetch(`${APPS_SCRIPT_URL}?page=${page}&pageSize=${PAGE_SIZE}`);
      const json = await res.json();
      if(!json.success) throw new Error(json.message);

      if(json.totalCount) totalImagesCount = json.totalCount;
      totalCountEl.textContent = totalImagesCount;

      IMAGES.push(...json.data.map(x=>({id:x.id,name:x.name||"Quote"})));
      updateProgressText(IMAGES.length, totalImagesCount);

      hasMore = json.hasMore;
      page++;
    }

    // Done ‚úÖ
    loading.style.display = "none";
    randomBtn.disabled = false;

    // Hide status line cleanly
    setTimeout(() => {
      statusText.textContent = "";
      statusText.style.display = "none";
    }, 800);
  }

  function showRandom(){
    const i = Math.floor(Math.random() * IMAGES.length);
    const {id,name} = IMAGES[i];

    placeholder.style.display="none";
    imgEl.classList.remove("show");

    loading.style.display="flex";
    loadingText.textContent="Loading quote‚Ä¶";

    const url = `https://lh3.googleusercontent.com/d/${id}?v=${Date.now()}`;
    imgEl.src = url;
    imgEl.alt = name;
    imgEl.onload = () => { loading.style.display="none"; imgEl.classList.add("show"); };
    imgEl.onerror = () => {
      loading.style.display="none";
      placeholder.textContent="Could not load quote";
      placeholder.style.display="block";
    };
  }

  window.addEventListener("load", loadAllQuotes);
  randomBtn.addEventListener("click", showRandom);
</script>
</body>
</html>
